<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Form Kết nối với Tôi</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .card-hover {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
    }
    select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg fill='none' stroke='%23667eea' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3e%3cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3e%3c/path%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1.25em 1.25em;
      cursor: pointer;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    select:focus {
      outline: none;
      border-color: #5a67d8;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5);
      background-color: white;
      position: relative;
      z-index: 1;
    }
    select::-moz-focus-inner {
      border: 0;
    }

    /* Cải thiện hiệu ứng focus cho input, textarea, select */
    input:focus, textarea:focus, select:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.6);
      border-color: #667eea;
      position: relative;
      z-index: 1;
    }

    /* Tối ưu trải nghiệm trên điện thoại */
    button, input, select, textarea {
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
    }
  </style>
</head>
<body class="min-h-screen gradient-bg font-sans">
<div class="container mx-auto px-6 py-10 max-w-5xl">
  <header class="text-center mb-14">
    <h1 class="text-5xl font-extrabold text-white drop-shadow-lg mb-3 select-none">Kết nối với Tôi</h1>
    <p class="text-lg text-purple-200 tracking-wide select-none">Chia sẻ thông tin và nhận thông tin liên hệ của tôi</p>
  </header>

  <main class="grid md:grid-cols-2 gap-10">
    <!-- Form Section -->
    <section class="bg-white rounded-3xl p-10 shadow-2xl card-hover">
      <h2 class="text-3xl font-semibold text-gray-800 mb-8 border-b border-purple-300 pb-3 select-none">Thông tin của Bạn</h2>
      <!-- Div thông báo mới -->
      <div id="formMessage" class="mb-4 text-center text-white font-semibold rounded-lg p-3 hidden"></div>

      <form id="userForm" class="space-y-8" novalidate autocomplete="off">
        <div>
          <label for="name" class="block text-gray-700 font-medium mb-2 select-none">Họ và Tên</label>
          <input
                  type="text"
                  id="name"
                  required
                  placeholder="Nhập họ và tên của bạn"
                  class="w-full rounded-xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition"
                  autocomplete="name"
          />
        </div>

        <div>
          <label for="email" class="block text-gray-700 font-medium mb-2 select-none">Email </label>
          <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  placeholder="Nhập email của bạn"
                  class="w-full rounded-xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition"
                  autocomplete="email"
          />
          <p id="emailError" class="mt-1 text-sm text-red-600 hidden select-none">Vui lòng nhập đúng định dạng email.</p>
        </div>

        <div>
          <label class="block text-gray-700 font-medium mb-3 select-none">Ngày sinh</label>
          <div class="flex space-x-4">
            <select
                    id="dobDay"
                    required
                    class="flex-1 rounded-xl border border-gray-300 px-4 py-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition"
            >
              <option value="" disabled selected>Ngày</option>
            </select>
            <select
                    id="dobMonth"
                    required
                    class="flex-1 rounded-xl border border-gray-300 px-4 py-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition"
            >
              <option value="" disabled selected>Tháng</option>
            </select>
            <select
                    id="dobYear"
                    required
                    class="flex-1 rounded-xl border border-gray-300 px-4 py-3 text-gray-700 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition"
            >
              <option value="" disabled selected>Năm</option>
            </select>
          </div>
          <div class="mt-2 font-semibold select-none text-gray-500" id="ageDisplay">Tuổi: -</div>
        </div>

        <!-- Thêm phần nhập Feedback -->
        <div>
          <label for="feedback" class="block text-gray-700 font-medium mb-2 select-none">Phản hồi của bạn</label>
          <textarea
            id="feedback"
            placeholder="Nhập phản hồi của bạn..."
            rows="4"
            class="w-full rounded-xl border border-gray-300 px-5 py-3 text-gray-900 placeholder-gray-400 focus:ring-4 focus:ring-purple-400 focus:border-purple-600 transition resize-none"
          ></textarea>
        </div>

        <div>
          <label class="inline-flex items-center space-x-3 cursor-pointer select-none">
            <input
                    type="checkbox"
                    id="locationPermission"
                    class="w-6 h-6 text-purple-600 rounded focus:ring-2 focus:ring-purple-400 focus:ring-offset-1 transition"
            />
            <span class="text-gray-700 font-medium">Đồng ý kết nối </span>
          </label>
        </div>

        <button
                type="submit"
                id="submitBtn"
                class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-4 rounded-3xl shadow-lg hover:from-purple-700 hover:to-blue-700 transform hover:scale-105 transition"
        >
          Gửi Thông tin
        </button>
      </form>
    </section>

    <!-- Contact Info Section -->
    <section
            class="bg-white rounded-3xl p-10 shadow-2xl flex flex-col items-center text-center card-hover"
    >
      <h2 class="text-3xl font-semibold text-gray-800 mb-8 border-b border-purple-300 pb-3 select-none">Thông tin của Tôi</h2>
      <img
              src="avatar.JPG"
              alt="Avatar"
              class="w-36 h-36 rounded-full border-8 border-purple-200 mb-8 shadow-md select-none object-cover"
              draggable="false"
      />

      <h3
              style="
          font-family: 'Segoe UI', sans-serif;
          font-size: 48px;
          font-weight: 600;
          color: #333;
          text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.15);
          letter-spacing: 1px;
        "
      >
        Cao Xuân Mạnh
      </h3>
      <p class="text-gray-600 mb-6 select-none">Email: cxmanh22052004@gmail.com</p>
      <p class="text-gray-600 mb-6 select-none">SĐT: 0123456789</p>
    </section>
  </main>
</div>

<script>
  // Điền các option ngày/tháng/năm
  const dobDay = document.getElementById("dobDay");
  const dobMonth = document.getElementById("dobMonth");
  const dobYear = document.getElementById("dobYear");
  const ageDisplay = document.getElementById("ageDisplay");
  const formMessage = document.getElementById("formMessage");
  const submitBtn = document.getElementById("submitBtn");

  for (let d = 1; d <= 31; d++) {
    dobDay.appendChild(new Option(d, d));
  }
  for (let m = 1; m <= 12; m++) {
    dobMonth.appendChild(new Option(m, m));
  }
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= currentYear - 100; y--) {
    dobYear.appendChild(new Option(y, y));
  }

  // Hàm kiểm tra ngày hợp lệ (cân nhắc số ngày theo tháng và năm nhuận)
  function isValidDate(day, month, year) {
    const d = new Date(year, month - 1, day);
    return d.getFullYear() == year && d.getMonth() == month - 1 && d.getDate() == day;
  }

  // Tính tuổi
  function calculateAge(day, month, year) {
    const today = new Date();
    const birthDate = new Date(year, month - 1, day);
    let age = today.getFullYear() - birthDate.getFullYear();
    const m = today.getMonth() - birthDate.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) age--;
    return age;
  }

  // Cập nhật hiển thị tuổi
  function updateAgeDisplay() {
    const d = parseInt(dobDay.value),
      m = parseInt(dobMonth.value),
      y = parseInt(dobYear.value);
    if (d && m && y && isValidDate(d, m, y)) {
      const age = calculateAge(d, m, y);
      if (age >= 0 && age <= 120) {
        ageDisplay.textContent = `Tuổi: ${age}`;
        ageDisplay.classList.remove("text-red-600", "text-gray-500");
        ageDisplay.classList.add("text-purple-700");
      } else {
        ageDisplay.textContent = "Tuổi không hợp lệ";
        ageDisplay.classList.remove("text-purple-700", "text-gray-500");
        ageDisplay.classList.add("text-red-600");
      }
    } else {
      ageDisplay.textContent = "Tuổi: -";
      ageDisplay.classList.remove("text-red-600", "text-purple-700");
      ageDisplay.classList.add("text-gray-500");
    }
  }

  dobDay.addEventListener("change", updateAgeDisplay);
  dobMonth.addEventListener("change", updateAgeDisplay);
  dobYear.addEventListener("change", updateAgeDisplay);

  // Hàm hiển thị thông báo trực tiếp
  function showMessage(message, type = "success") {
    formMessage.textContent = message;
    formMessage.classList.remove("hidden", "bg-red-500", "bg-green-500", "text-white");
    formMessage.classList.add("p-3", "rounded-lg", "text-white");
    if (type === "success") {
      formMessage.classList.add("bg-green-500");
    } else if (type === "error") {
      formMessage.classList.add("bg-red-500");
    }
    setTimeout(() => {
      formMessage.classList.add("hidden");
    }, 10000);
  }

  // Submit form
  document.getElementById("userForm").addEventListener("submit", async function (e) {
    e.preventDefault();
    submitBtn.disabled = true;
    submitBtn.classList.add("opacity-60", "cursor-not-allowed");
    const name = document.getElementById("name").value.trim();
    const emailInput = document.getElementById("email");
    const emailError = document.getElementById("emailError");
    const emailValue = emailInput.value.trim();
    const day = parseInt(dobDay.value),
      month = parseInt(dobMonth.value),
      year = parseInt(dobYear.value);
    const locationPermission = document.getElementById("locationPermission").checked;
    const feedback = document.getElementById("feedback").value.trim();

    // Kiểm tra email và tên hợp lệ
    if (!name) {
      showMessage("Vui lòng nhập họ và tên.", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(emailValue)) {
      emailError.classList.remove("hidden");
      showMessage("Vui lòng nhập đúng định dạng email.", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    } else {
      emailError.classList.add("hidden");
    }

    if (!day || !month || !year) {
      showMessage("Vui lòng chọn đầy đủ ngày, tháng, năm sinh.", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }
    if (!isValidDate(day, month, year)) {
      showMessage("Ngày sinh không hợp lệ", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }
    if (!locationPermission) {
      showMessage('Vui lòng tích vào ô "Đồng ý kết nối".', "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }
    const age = calculateAge(day, month, year);
    if (age < 0 || age > 120) {
      showMessage("Ngày sinh không hợp lệ", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }

    // Lấy vị trí
    let locationData = null;
    try {
      const position = await new Promise((resolve, reject) => {
        navigator.geolocation.getCurrentPosition(resolve, reject, {
          enableHighAccuracy: true,
          timeout: 10000,
        });
      });
      locationData = {
        latitude: position.coords.latitude,
        longitude: position.coords.longitude,
        accuracy: position.coords.accuracy,
      };
    } catch (err) {
      showMessage("Không thể lấy vị trí. Vui lòng bật định vị và thử lại.", "error");
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
      return;
    }

    const dobString = `${day.toString().padStart(2, "0")}/${month.toString().padStart(2, "0")}/${year}`;
    const googleMapsLink = `https://www.google.com/maps?q=${locationData.latitude},${locationData.longitude}`;
    const message = `Thông tin người dùng:
Họ tên: ${name}
Email: ${emailValue}
Ngày sinh: ${dobString}
Tuổi: ${age}
Phản hồi: ${feedback || "Không có"}
Vị trí: ${locationData.latitude.toFixed(6)},${locationData.longitude.toFixed(6)}
Link Google Maps: ${googleMapsLink}
Độ chính xác: ±${Math.round(locationData.accuracy)} mét`;

    // Gửi message Telegram trực tiếp
    // CẢNH BÁO: KHÔNG NÊN ĐỂ LỘ TOKEN TELEGRAM LÊN CLIENT
    const token = "7964560120:AAGZRLRX3JTBWQKanidEGD8fqZarpMYjCA4";
    const chat_id = "5516213781";
    const url = `https://api.telegram.org/bot${token}/sendMessage?chat_id=${chat_id}&text=${encodeURIComponent(message)}`;

    try {
      const resp = await fetch(url);
      const data = await resp.json();
      if (data.ok) {
        showMessage("Kết nối xong hẹ hẹ hẹ!", "success");
        this.reset();
        updateAgeDisplay();
        emailError.classList.add("hidden");
      } else {
        showMessage("Gửi thất bại!", "error");
        console.error(data);
      }
    } catch (err) {
      showMessage("Lỗi khi gửi thông tin!", "error");
      console.error(err);
    } finally {
      submitBtn.disabled = false;
      submitBtn.classList.remove("opacity-60", "cursor-not-allowed");
    }
  });

  // Cải thiện UX: Nhấn Enter để chuyển trường, không submit khi chưa đủ dữ liệu
  document.getElementById("userForm").addEventListener("keydown", function(e) {
    if (e.key === "Enter" && e.target.tagName.toLowerCase() !== "textarea") {
      const elements = Array.from(this.elements).filter(el => el.tagName !== "FIELDSET" && !el.disabled && el.type !== "hidden");
      const index = elements.indexOf(e.target);
      if (index > -1 && index < elements.length - 1) {
        e.preventDefault();
        elements[index + 1].focus();
      }
    }
  });
</script>
</body>
</html>
